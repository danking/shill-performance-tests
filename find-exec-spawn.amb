#lang shill/ambient

require "find-exec-spawn.cap",
        shill/native;

val src = open-dir("/usr/src");
val dev-null = open-file("/dev/null");
val wallet = create-wallet();
populate-native-wallet( wallet
                      , open-dir("/")
                      , "/usr/bin"
                      , "/libexec:/lib:/usr/lib"
                      , pipe-factory
                      );


find(src,
     name(".*\\.c$"),
     grep("mac_",
          dev-null,
          src,
          wallet));
